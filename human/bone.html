<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Three.js Bones Browser</title>
		<style>
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>

		<button onClick="onChangeBone()">Click me</button>
		<script src="three.js"></script>
		<script src="js/OrbitControls.js"></script>

		<script>
            var gui, scene, camera, renderer, orbit, lights, mesh, bones, skeletonHelper;

			var state = {
				animateBones : false
			};

			function initScene () {
				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0 );
				camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 100000);
				camera.position.set( 2000, 5000, 5000 );

				renderer = new THREE.WebGLRenderer({ antialias: true });
				renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.setClearColor(0x000000, 1);
				document.body.appendChild(renderer.domElement);

				orbit = new THREE.OrbitControls(camera, renderer.domElement);
				orbit.enableZoom = true;

				lights = [];
				lights[0] = new THREE.DirectionalLight( 0xffffff, 1 );
 				lights[1] = new THREE.PointLight( 0xffffff, 1, 0 );

				lights[0].position.set( 0, 140, 500 );
				lights[0].position.multiplyScalar( 1.1 );
				lights[0].color.setHSL( 0.6, 0.075, 1 );
				lights[1].position.set( 0, - 1, 0 );

				scene.add(lights[0]);
				scene.add(lights[1]);

				window.addEventListener('resize', function () {
					camera.aspect = window.innerWidth / window.innerHeight;
					camera.updateProjectionMatrix();
					renderer.setSize( window.innerWidth, window.innerHeight );
				}, false );

				initBones();
			}


			function initBones () {
				//var segmentHeight = 8;
				//var segmentCount = 4;
				//var height = segmentHeight * segmentCount;
				//var halfHeight = height * 0.5;

				//var sizing = {
				//	segmentHeight : segmentHeight,
				//	segmentCount : segmentCount,
				//	height : height,
				//	halfHeight : halfHeight
				//};

				//var geometry = createGeometry( sizing );
				//var bones = createBones(sizing);
				//mesh = createMesh( geometry, bones );

				/* Create mesh */
				// var material = new THREE.MeshNormalMaterial({
				// 		color: 0, //13359858,
				// 		transparent: true,
				// 		opacity: 1,
				// 		specular: 10.0,
				// 		skinning: true,
				// 		morphTargets: true,
				// 		wireframe: false
				// });

				// try to load the character
				var loader = new THREE.ObjectLoader();
				loader.load("models/skinned/marine/marine_anims.json", function (loadedObject) {
					//geometry.computeBoundingBox();
					//geometry.computeVertexNormals();
					loadedObject.traverse(function(child) {
						if (child instanceof THREE.SkinnedMesh) {
							mesh = child;
						}
					});
					//var mesh = new THREE.SkinnedMesh(geometry, material);
					// var skeleton = new THREE.Skeleton(bones);
					// mesh.add(bones[0]);

					//mesh.bind(skeleton);
                    //mesh.rotation.y = - 135 * Math.PI / 180;
                    mesh.scale.set(30, 30, 30);
                    mesh.scale.multiplyScalar(1);
                    // var bb = geometry.boundingBox;
                    // console.log(bb);
                    // mesh.position.set(0, -500 - bb.min.y * 30, -300);
                    scene.add(mesh);

                    skeletonHelper = new THREE.SkeletonHelper(mesh);
					//skeletonHelper.material.linewidth = 2;
					scene.add(skeletonHelper);
				});
			}

			function onChangeBone() {
				console.log(skeletonHelper.bones.length);
				skeletonHelper.bones[21].rotation.y =  -Math.PI * 0.5;
			}

			function render(){
				requestAnimationFrame(render);
				var time = Date.now() * 0.001;

				renderer.render( scene, camera );
			}

			initScene();
			render();
		</script>
	</body>
</html>
