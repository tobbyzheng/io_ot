<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Three.js Bones Browser</title>
		<style>
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>

		<script src="three.min.js"></script>
		<script src="js/OrbitControls.js"></script>
		<!--<script src="js/stats.min.js"></script>-->
        <button onClick="onChangeBoneX()">x</button>
        <button onClick="onChangeBoneY()">y</button>
        <button onClick="onChangeBoneZ()">z</button>
        <button onClick="testQuaternion()">quaterion</button>
		<div id="human-robot"></div>
		<!---<button id="fps_button" onClick="showFPS()">FPS</button>-->
		<script>
            //(function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='js/stats.min.js';document.head.appendChild(script);})()
            var scene, camera, renderer, orbit, lights, mesh, skeletonHelper;

			/*var state = {
				animateBones : true
			};*/

			function initScene () {
				scene = new THREE.Scene();
				scene.background = new THREE.Color(0);
				camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 100000);
				camera.position.set( 2000, 5000, 5000 );

				renderer = new THREE.WebGLRenderer({ antialias: true });
				renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.setClearColor(0x000000, 1);
				document.getElementById('human-robot').appendChild(renderer.domElement);

				orbit = new THREE.OrbitControls(camera, renderer.domElement);
				orbit.enableZoom = true;
				orbit.target.set(0, 3000, 0);

				lights = [];
				lights[0] = new THREE.DirectionalLight( 0xffffff, 1 );
 				lights[1] = new THREE.PointLight( 0xffffff, 1, 0 );

				lights[0].position.set( 0, 140, 500 );
				lights[0].position.multiplyScalar( 1.1 );
				lights[0].color.setHSL( 0.6, 0.075, 1 );
				lights[1].position.set( 0, - 1, 0 );

				scene.add(lights[0]);
				scene.add(lights[1]);
				scene.add(new THREE.AxesHelper(2000));
				window.addEventListener('resize', function () {
					camera.aspect = window.innerWidth / window.innerHeight;
					camera.updateProjectionMatrix();
					renderer.setSize( window.innerWidth, window.innerHeight );
				}, false );

				initBones();
			}

			function initBones () {
				//var segmentHeight = 8;
				//var segmentCount = 4;
				//var height = segmentHeight * segmentCount;
				//var halfHeight = height * 0.5;

				//var sizing = {
				//	segmentHeight : segmentHeight,
				//	segmentCount : segmentCount,
				//	height : height,
				//	halfHeight : halfHeight
				//};

				//var geometry = createGeometry( sizing );
				//var bones = createBones(sizing);
				//mesh = createMesh( geometry, bones );

				/* Create mesh */
				// var material = new THREE.MeshNormalMaterial({
				// 		color: 0, //13359858,
				// 		transparent: true,
				// 		opacity: 1,
				// 		specular: 10.0,
				// 		skinning: true,
				// 		morphTargets: true,
				// 		wireframe: false
				// });

				// try to load the character
				var loader = new THREE.ObjectLoader();
				loader.load("models/skinned/marine/marine_anims.json", function (loadedObject) {
					//geometry.computeBoundingBox();
					//geometry.computeVertexNormals();
					loadedObject.traverse(function(child) {
						if (child instanceof THREE.SkinnedMesh) {
							mesh = child;
						}
					});
					//var mesh = new THREE.SkinnedMesh(geometry, material);
					// var skeleton = new THREE.Skeleton(bones);
					// mesh.add(bones[0]);
					//mesh.bind(skeleton);
                    //mesh.rotation.y = - 135 * Math.PI / 180;
                    mesh.scale.set(30, 30, 30);
                    mesh.scale.multiplyScalar(1);
                    // var bb = geometry.boundingBox;
                    // console.log(bb);
                    // mesh.position.set(0, -500 - bb.min.y * 30, -300);
                    scene.add(mesh);

                    skeletonHelper = new THREE.SkeletonHelper(mesh);
					skeletonHelper.material.linewidth = 2;
					scene.add(skeletonHelper);
				});
			}

			function onChangeBoneX() {
				console.log(skeletonHelper.bones.length);
				skeletonHelper.bones[19].rotation.x =  Math.PI * 0.5;
			}
            function onChangeBoneY() {
                console.log(skeletonHelper.bones.length);
                skeletonHelper.bones[19].rotation.y = Math.PI * 0.5;
            }

            function onChangeBoneZ() {
                console.log(skeletonHelper.bones.length);
                skeletonHelper.bones[19].rotation.z = Math.PI * 0.5;
            }

			function testQuaternion() {
                /*console.log("20th bone postions below");
			    console.log(skeletonHelper.bones[20].position.x);
                console.log(skeletonHelper.bones[20].position.y);
                console.log(skeletonHelper.bones[20].position.z);
                console.log(skeletonHelper.bones[20].rotation.x);
                console.log(skeletonHelper.bones[20].rotation.y);
                console.log(skeletonHelper.bones[20].rotation.z);
                console.log("39th bone postions below");
                console.log(skeletonHelper.bones[39].position.x);
                console.log(skeletonHelper.bones[39].position.y);
                console.log(skeletonHelper.bones[39].position.z);
                console.log(skeletonHelper.bones[39].rotation.x);
                console.log(skeletonHelper.bones[39].rotation.y);
                console.log(skeletonHelper.bones[39].rotation.z);*/
                skeletonHelper.bones[38].rotation.x = 1.9;
                skeletonHelper.bones[19].rotation.x = -1.9;
                skeletonHelper.bones[39].position.x += 2.1;
                skeletonHelper.bones[20].position.x += 2.1;
                skeletonHelper.bones[39].rotation.x = - 1.2;
                skeletonHelper.bones[39].rotation.y = -0.1;
                skeletonHelper.bones[20].rotation.x = 1.2;
                skeletonHelper.bones[20].rotation.y = -0.1;

                console.log("19");
                console.log(skeletonHelper.bones[19].position);
                console.log(skeletonHelper.bones[19].rotation);
                console.log("20");
                console.log(skeletonHelper.bones[20].position);
                console.log(skeletonHelper.bones[20].rotation);
                console.log("38");
                console.log(skeletonHelper.bones[38].position);
                console.log(skeletonHelper.bones[38].rotation);
                console.log("39");
                console.log(skeletonHelper.bones[39].position);
                console.log(skeletonHelper.bones[39].rotation);
			    //var q1 = new THREE.Quaternion(-0.174867, -0.135915, 0.128322, 0.980842);
			    //console.log("q1: "+q1);
                //skeletonHelper.bones[39].applyQuaternion(q1);
            }


			/*function showFPS() {
				var fpsbutton = document.getElementById('fps_button');
				var stat = new Stats();
				var fps = stat.getFPS();
				fpsbutton.innerHTML = "FPS="+fps;
            }*/

			function render(){
                requestAnimationFrame(render);
				renderer.render( scene, camera );
                //var time = Date.now() * 0.001;
			}
			initScene();
			render();
		</script>
	</body>
</html>
